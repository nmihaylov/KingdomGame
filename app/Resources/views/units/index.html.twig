{% extends 'base.html.twig' %}

{% block main %}
    {% if err %}
        <div class="alert alert-dismissible alert-danger">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <strong>{{ err }}</strong>
        </div>
    {% endif %}
    <div class="col-sm-6">
        <h3>Units in Kingdom</h3>
        <table class="table table-striped table-hover ">
            <thead>
            <tr>
                <th>Name</th>
                <th>Amount</th>
            </tr>
            </thead>
            <tbody>
            {% for unit in kingdom.units %}
                <tr>
                    <td>{{ unit.unit.name }}</td>
                    <td>{{ unit.amount }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>


    <div class="col-sm-12">
        <h3>Units in progress</h3>
        <table class="table table-striped table-hover ">
            <thead>
            <tr>
                <th>Name</th>
                <th>Amount to be added</th>
                <th>Finish after</th>
            </tr>
            </thead>
            <tbody>
            {% for unit in unitsInProgress %}
                <tr>
                    <td>{{ unit.unit.unit.name }}</td>
                    <td>{{ unit.amount }}</td>
                    <td>
                        {% set difference = date(unit.finishesOn|date("Y-m-d H:i:s")).diff(date(now|date("Y-m-d H:i:s"))) %}
                        {{ difference|date("%d \days %h \hours %i \minutes %s \seconds") }}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>


    <div class="col-sm-12">
        <h3>Barracks - arm more units</h3>
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>Name</th>
                <th>You need</th>
                <th>Costs per 1 unit</th>
                <th>Add units</th>
            </tr>
            </thead>
            <tbody>

            {% for unit in units %}
                <tr>
                    <td>{{ unit.name }}</td>
                    <td>
                        {% for unitDependency in unit.unitDependencies %}
                            {{ unitDependency.building.name }}: level {{ unitDependency.buildingLevel }}
                        {% endfor %}
                    </td>
                    <td>
                        {% for unit_cost in unit.costs %}
                            <b>{{ unit_cost.resource.name }}</b>: {{ unit_cost.amount }}
                        {% endfor %}
                    </td>
                    <td>
                        {#TODO: make more than just 1 per click#}
                        <a class="btn btn-primary btn-xs" href="{{ path("arm_unit", {id: unit.id}) }}">Arm 5 units</a>
                    </td>

                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>


    <div class="col-sm-12">
        <h3>Barracks - arm more units</h3>

        <div class="row">
            <div class="col-sm-3">Name</div>
            <div class="col-sm-3">Costs per 1 unit</div>
            <div class="col-sm-3">Count</div>
            <div class="col-sm-3">Add units</div>
        </div>


        {#{{ form_start(form) }}#}
        {#{{ form_widget(form.unit_count) }}#}
        {#{{ form_widget(form.unit_id) }}#}
        {#<button type="submit">Try this!</button>#}
        {#{{ form_end(form) }}#}

        {% for unit in units %}



            <div class="row">
                <form name="unit" method="post" action="{{ path("arm_unit") }}">
                    <div class="col-sm-3">{{ unit.name }}</div>
                    <div class="col-sm-3">   {% for unit_cost in unit.costs %}
                            <b>{{ unit_cost.resource.name }}</b>: {{ unit_cost.amount }}
                        {% endfor %}</div>
                    <div class="col-sm-3"><input type="hidden" id="unit_unit_id" name="kingdom_unit[unit]"
                                                 value="{{ unit.id }}">
                        <input type="hidden" id="unit_unit_id" name="kingdom_unit[kingdom]" value="{{ kingdom.id }}">
                        <input type="number" id="unit_unit_count" name="kingdom_unit[amount]" class="form-control">
                    </div>
                    <div class="col-sm-3">
                        <button type="submit">Arm units</button>
                    </div>
                    {{ form_row(form._token) }}
                </form>
            </div>



        {% endfor %}

    </div>

{% endblock %}