{% extends 'base.html.twig' %}

{% block main %}
    {% if err %}
        <div class="alert alert-dismissible alert-danger">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <strong>{{ err }}</strong>
        </div>
    {% endif %}
    <div class="col-sm-6">
        <h3>Units in Kingdom</h3>
        <table class="table table-striped table-hover ">
            <thead>
            <tr>
                <th>Name</th>
                <th>Amount</th>
            </tr>
            </thead>
            <tbody>
            {% for unit in kingdom.units %}
                <tr>
                    <td>{{ unit.unit.name }}</td>
                    <td>{{ unit.amount }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>


    <div class="col-sm-12">
        <h3>Units in progress</h3>
        <table class="table table-striped table-hover ">
            <thead>
            <tr>
                <th>Name</th>
                <th>Amount to be added</th>
                <th>Finish after</th>
            </tr>
            </thead>
            <tbody>
            {% for unit in unitsInProgress %}
                <tr>
                    <td>{{ unit.unit.unit.name }}</td>
                    <td>{{ unit.amount }}</td>
                    <td>
                        {% set difference = date(unit.finishesOn|date("Y-m-d H:i:s")).diff(date(now|date("Y-m-d H:i:s"))) %}
                        {{ difference|date("%d \days %h \hours %i \minutes %s \seconds") }}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>


    <div class="col-sm-12">
        <h3>Barracks - arm more units</h3>
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>Name</th>
                <th>You need</th>
                <th>Costs per 1 unit</th>
                <th>Add units</th>
            </tr>
            </thead>
            <tbody>

            {% for unit in units %}
                <tr>
                    <td>{{ unit.name }}</td>
                    <td>
                        {% for unitDependency in unit.unitDependencies %}
                            {{ unitDependency.building.name }}: level {{ unitDependency.buildingLevel }}
                        {% endfor %}
                    </td>
                    <td>
                        {% for unit_cost in unit.costs %}
                            <b>{{ unit_cost.resource.name }}</b>: {{ unit_cost.amount }}
                        {% endfor %}
                    </td>
                    <td>
                        {#TODO: make more than just 1 per click#}
                        <a class="btn btn-primary btn-xs" href="{{ path("arm_unit", {id: unit.id}) }}">Arm 5 units</a>
                    </td>

                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>


    <div class="col-sm-12">
        <h3>Barracks - arm more units</h3>
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>Name</th>
                <th>Costs per 1 unit</th>
                <th>Count</th>
                <th>Add units</th>
            </tr>
            </thead>
            {#TEST FROM HERE#}
            <tbody>


            {#{{ form_start(form) }}#}
            {#{{ form_widget(form.unit_count) }}#}
            {#{{ form_widget(form.unit_id) }}#}
            {#<button type="submit">Try this!</button>#}
            {#{{ form_end(form) }}#}

            {% for unit in units %}
                <form name="unit" method="post" action="{{ path("arm_unit", {id: unit.id}) }}">

                    <tr>
                        <td>{{ unit.name }}</td>
                        <td>
                            {% for unit_cost in unit.costs %}
                                <b>{{ unit_cost.resource.name }}</b>: {{ unit_cost.amount }}
                            {% endfor %}
                        </td>
                        <td>
                            <input type="hidden" id="unit_unit_id" name="unit[unit_id]" value="{{ unit.id }}">
                            <input type="hidden" id="unit_unit_id" name="unit[kingdom_id] value="{{ kingdom.id }}">
                            <input type="number" id="unit_unit_count" name="unit[amount]" required="required"
                                   class="form-control">
                        </td>
                        <td>
                            <button type="submit">Arm units</button>
                        </td>

                    </tr>
                    {#{{ form_row(form._token) }}#}
                </form>
            {% endfor %}
            </tbody>
        </table>
    </div>

{% endblock %}